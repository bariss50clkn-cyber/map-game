<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Harita SavaÅŸÄ± CanlÄ±</title>
    <script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #0b0e14; overflow: hidden; color: white; }
        #svg-holder { width: 100vw; height: 100vh; }
        path { fill: #2a2e35; stroke: #121418; stroke-width: 0.3; transition: fill 0.5s ease; }
        .info { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.85); padding: 12px; border-radius: 8px; z-index: 100; border: 1px solid #444; font-family: sans-serif; }
    </style>
</head>
<body>
    <div class="info">
        <div id="status" style="color: #4ade80;">Sinyal Bekleniyor... ðŸŸ¢</div>
        <div id="log" style="font-size: 11px; margin-top: 5px; color: #aaa;"></div>
    </div>
    <div id="svg-holder"></div>

    <script>
        let provinces = [];
        
        // 1. HaritayÄ± yÃ¼kle
        fetch('map.svg').then(res => res.text()).then(data => {
            document.getElementById('svg-holder').innerHTML = data;
            const svg = document.querySelector('svg');
            svgPanZoom(svg, { zoomEnabled: true, controlIconsEnabled: false, fit: true, center: true });
            provinces = Array.from(document.querySelectorAll('path'));
        });

        // 2. Boyama Fonksiyonu
        const tetikleBoya = (isim) => {
            if (provinces.length === 0) return;
            const renk = `hsl(${Math.random() * 360}, 80%, 60%)`;
            const hedef = provinces[Math.floor(Math.random() * provinces.length)];
            hedef.style.fill = renk;
            document.getElementById('log').innerText = "Son: " + (isim || "Yeni Hediye!");
        };

        // 3. TIKFINITY VERÄ°SÄ°NÄ° YAKALAMA (Webhook & URL Check)
        setInterval(() => {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('user')) {
                tetikleBoya(urlParams.get('user'));
                // Linki temizle ki sÃ¼rekli boyamasÄ±n
                window.history.replaceState({}, document.title, "/");
            }
        }, 500);

        // Mesaj gelirse dinle
        window.addEventListener('message', (event) => {
            tetikleBoya("Hediye");
        });
    </script>
</body>
</html>
