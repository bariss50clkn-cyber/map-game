<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>CanlÄ± Harita SavaÅŸÄ±</title>
    <script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #0b0e14; overflow: hidden; color: white; font-family: sans-serif; }
        #svg-holder { width: 100vw; height: 100vh; }
        path, polygon, circle, rect { transition: fill 0.6s ease; stroke: #121418; stroke-width: 0.1; }
        .ui-panel { position: absolute; top: 15px; left: 15px; background: rgba(15, 20, 30, 0.9); padding: 15px; border-radius: 12px; z-index: 1000; border: 1px solid #444; }
        #alert-box { position: absolute; top: 20%; left: 50%; transform: translateX(-50%); font-size: 24px; font-weight: bold; color: #ffd700; display: none; z-index: 2000; text-align: center; }
    </style>
</head>
<body>
    <div id="alert-box"></div>
    <div class="ui-panel">
        <div style="color:#4ade80; font-weight:bold;">SÄ°STEM CANLI ðŸŸ¢</div>
        <div id="log" style="font-size:12px; margin-top:5px;">Hediye bekleniyor...</div>
    </div>
    <div id="svg-holder"></div>

    <script>
        let provinces = [];
        const userColors = {};

        // 1. HaritayÄ± YÃ¼kle
        fetch('map.svg').then(res => res.text()).then(data => {
            document.getElementById('svg-holder').innerHTML = data;
            const svg = document.querySelector('svg');
            svgPanZoom(svg, { zoomEnabled: true, controlIconsEnabled: false, fit: true, center: true });
            provinces = Array.from(document.querySelectorAll('path, polygon, circle, rect'));
        });

        // 2. Boyama Fonksiyonu
        const savas = (user, amount) => {
            if (!provinces.length) return;
            if (!userColors[user]) userColors[user] = `hsl(${Math.random() * 360}, 85%, 60%)`;
            
            let power = amount >= 500 ? 100 : Math.ceil(amount / 5);
            
            const alertBox = document.getElementById('alert-box');
            alertBox.innerText = `${user} SALDIRDI!`;
            alertBox.style.display = 'block';
            setTimeout(() => alertBox.style.display = 'none', 2000);

            for (let i = 0; i < power; i++) {
                const target = provinces[Math.floor(Math.random() * provinces.length)];
                target.style.fill = userColors[user];
            }
            document.getElementById('log').innerText = "Son: " + user;
        };

        // 3. CANLI DÄ°NLEME (Kritik Nokta)
        // TikFinity Webhook gÃ¶nderdiÄŸinde bu fonksiyon tetiklenir
        window.addEventListener('message', function(event) {
            // Webhook'tan gelen veriyi iÅŸle
            if (event.data && event.data.type === 'webhook') {
                savas(event.data.nickname, event.data.diamondCount);
            }
        });

        // URL Ã¼zerinden gelen veriyi de kontrol et (Yedek yÃ¶ntem)
        setInterval(() => {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('user')) {
                savas(urlParams.get('user'), parseInt(urlParams.get('amount') || 1));
                window.history.replaceState({}, document.title, "/");
            }
        }, 500);
    </script>
</body>
</html>
